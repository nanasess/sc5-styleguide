## 概要

- 日本語でやりとりをお願いします。
- このプロジェクトは2018年までメンテされていましたが、現在はメンテされていません。
- 最新の node v22 で動作することを目指します。
- node v22 で動作しないパッケージは、別のパッケージに代替するか、最新バージョンにマイグレーションします
- node v22.14.0 で `npm run demo` が成功し、ブラウザでスタイルガイドの表示を確認済みです。
- タスクが完了したら、[.github/prompts](.github/prompts) 以下に `YYYYMMhhmm.md` というファイル名で、プロンプトの履歴を保存してください。
- zsh を使用しているため ^ 付きのバージョンやワイルドカードは引用符で囲ってください
- できるかぎり overrides を使用せず、関連パッケージが古いバージョンに依存している場合は、関連パッケージをマイグレーションしてください

## 直接編集不可のファイル

以下のファイル・ディレクトリ内のファイルは直接編集せず、 gulp プロセスを調整してください
- lib/app/js/components
- lib/dist
- demo-output

## テストの実施

### ユニットテスト及びインテグレーションテスト

`npm run test` でテストを実行します。

- node v22.14.0 ですべてのテストが成功することを確認済みです。
- パッケージをマイグレーションした後は、 `npm run test` でテストが成功することを確認してください
- `npm run test` に失敗した場合は、テストが成功するようテストケースを修正してください

### E2Eテスト

`npm run demo` でデモ環境を起動したあと、
`npm run test:e2e` で実行します。

- node v22.14.0 ですべてのテストが成功することを確認済みです。
- パッケージをマイグレーションした後は、 `npm run test:e2e` でテストが成功することを確認してください
- `npm run test:e2e` に失敗した場合は、テストが成功するようテストケースを修正してください

## node.js のバージョン切替

`n` コマンドを利用して、バージョン切替が可能です。

``` shell
sudo n <version>
```

現在は以下のバージョンがインストール可能です。

node/6.9.5
node/8.17.0
node/12.22.12
node/14.21.3
node/16.20.2
node/22.14.0

*`n` コマンドがインストールされていない場合は `npm install -g n` でインストールしてください。*


## npm警告対応方針

`npm install` 実行時に多数の警告が発生しています。以下は優先順位別の対応チェックリストです：

### 高優先度（セキュリティリスク/メモリリーク対応）

- [X] **minimatch の古いバージョンの更新**
  - 対応内容: RegExp DoS脆弱性の修正のため、minimatch 3.0.2以上に更新
  - 影響: システムのセキュリティリスク
  - 関連パッケージ: `minimatch@0.2.14`, `minimatch@0.3.0`, `minimatch@2.0.10`

以下のパッケージを更新する必要があります：

- gulp-istanbul: 0.10.0 → 最新バージョン
- gulp-mocha: 2.2.0 → 最新バージョン
- jscs: 2.6.0 → 最新バージョン または ESLintへの移行検討
- main-bower-files: 2.9.0 → 最新バージョン


- [X] **core-js の更新**
  - 対応内容: 著しいパフォーマンス低下の原因となるため、v3.23.3以上に更新
  - 影響: アプリケーション速度の大幅低下
  - 関連パッケージ: `core-js@1.2.7`, `core-js@2.6.12`

- [ ] **inflight パッケージのメモリリーク修正**
  - 対応内容: lru-cacheへの置き換え
  - 影響: メモリリークによるアプリケーション不安定化
  - 関連パッケージ: `inflight@1.0.6`
  - glob のマイグレーションも必要

- [X] **natives パッケージのNode.js内部APIへの依存対応**
  - 対応内容: graceful-fs@4.xに更新
  - 影響: Node.jsバージョン更新時に突然動作しなくなるリスク
  - 関連パッケージ: `natives@1.1.6`

### 中優先度（広く使用されるコアパッケージ）

- [ ] **rimraf の更新**
  - 対応内容: 最新バージョン(v4以上)へ更新
  - 影響: ビルドプロセスの安定性
  - 関連パッケージ: `rimraf@2.7.1`, `rimraf@2.6.3`

- [ ] **uuid パッケージの更新**
  - 対応内容: v7以上へ更新（Math.random()関連の脆弱性対策）
  - 影響: ID生成の予測可能性による潜在的なセキュリティリスク
  - 関連パッケージ: `uuid@1.4.2`, `uuid@2.0.3`, `uuid@3.4.0`

- [ ] **glob パッケージの更新**
  - 対応内容: v9以上に更新
  - 影響: ファイルマッチング機能の安定性
  - 関連パッケージ: `glob@7.2.3`, `glob@5.0.15`, `glob@6.0.4` など多数
  - 多くのパッケージで利用されており、利用パッケージのマイグレーションが必要

- [X] **graceful-fs の更新**
  - 対応内容: v4以上に更新
  - 影響: ファイルシステム操作の安定性
  - 関連パッケージ: `graceful-fs@1.2.3`, `graceful-fs@2.0.3`

- [X] **request の代替**
  - 対応内容: メンテナンスされていないrequestパッケージの代替
  - 影響: HTTP通信の安定性
  - 関連パッケージ: `request@2.79.0`, `request@2.88.2`
  - 代替案: `node-fetch`, `axios`, `got` など

### 低優先度（機能に直接影響しないもの）

- [ ] **gulp-util から推奨代替パッケージへの移行**
  - 対応内容: Medium記事に従って代替パッケージへ移行
  - 影響: ビルドシステムの最新化
  - 関連パッケージ: 複数の `gulp-util` バージョン
  - 参考: https://medium.com/gulpjs/gulp-util-ca3b1f9f9ac5

- [ ] **babel プラグイン関連の更新**
  - 対応内容: 非推奨babelプラグインの最新代替へ更新
  - 影響: より良いJavaScriptコードの生成
  - 関連パッケージ: 多数の `babel-plugin-*`

- [X] **コード整形・リント系ツールの更新**
  - 対応内容: ~~JSCSからESLintへの移行~~ JSCS は利用優先度が低いため削除しました
  - 影響: より良いコード品質管理
  - 関連パッケージ: `jscs@2.6.0`, `jscs-preset-wikimedia@1.0.1`

- [X] **テスト関連パッケージの更新**
  - 対応内容: ~~istanbulからnycへの移行など~~ カバレッジ機能は使用しないため istanbul は削除しました
  - 影響: テストカバレッジ測定の改善
  - 関連パッケージ: `istanbul@0.3.22`, `istanbul@0.4.5`, `sinon@1.17.7`

- [ ] **その他の非推奨ユーティリティの更新**
  - 対応内容: lodash.template, mkdirp, wrench等の最新代替へ更新
  - 影響: 将来的なメンテナンス性向上
  - 関連パッケージ: `lodash.template`, `mkdirp`, `wrench`, `trim` など多数

## セキュリティマイグレーション計画

### 高優先度（セキュリティリスク/重大な脆弱性）

- [X] **socket.io の更新**
   - 現在: ~1.4.0
   - 脆弱性: クリティカル/高（複数のws、debug、parseuri、パフォーマンスの問題）
   - 対応: 最新バージョン（4.x系）へアップデート
   - 影響範囲: アプリケーション全体の通信機能

- [X] **express および関連パッケージの更新**
   - 現在: ~4.13.0
   - 脆弱性: 高（path-to-regexp、cookie、fresh、qs、debug、ms、finalhandler、serve-static など）
   - 対応: 4.21.x へアップデート（互換性を保ちながら）
   - 影響範囲: サーバーサイドの基盤

- [ ] **cheerio の更新**
   - 現在: ^0.19.0
   - 脆弱性: 高（css-what、nth-check、css-select など）
   - 対応: 1.0.0以上にアップデート
   - 影響範囲: HTMLパース機能

- [ ] **basic-auth-connect の更新**
   - 現在: ~1.0.0
   - 脆弱性: 高（タイミング攻撃の脆弱性）
   - 対応: 1.1.0以上にアップデート
   - 影響範囲: 認証機能

- [ ] **minimist の更新**
   - 現在: ^1.2.0
   - 脆弱性: クリティカル（プロトタイプ汚染）
   - 対応: 1.2.6以上にアップデート
   - 影響範囲: コマンドライン引数処理

- [ ] **gonzales-pe の更新** (minimist依存)
   - 現在: 4.0.3
   - 脆弱性: クリティカル（minimistを通じたプロトタイプ汚染）
   - 対応: 最新バージョンへアップデート
   - 影響範囲: スタイルシートパーシング

- [ ] **gulp-util から代替パッケージへ**
   - 現在: ~3.0.5
   - 脆弱性: 高（lodash.template、および複数の間接依存関係）
   - 対応: gulp-utilを分割して代替パッケージを使用
   - 影響範囲: gulpタスク全般

- [ ] **lodash.template の更新**
   - 現在: 古いバージョン（gulp-utilの依存）
   - 脆弱性: 高（コマンドインジェクション）
   - 対応: 4.5.0以上にアップデート

- [ ] **markdown-it の更新**
   - 現在: ^8.3.1
   - 脆弱性: 中程度（リソース消費の問題）
   - 対応: 12.3.2以上にアップデート
   - 影響範囲: マークダウンのレンダリング

### 中優先度（メンテナンス関連）

- [ ] **gulp-ng-annotate の依存関係の更新**
   - 現在: ~1.1.0
   - 脆弱性: 高（merge、minimist）
   - 対応: 最新バージョンへのアップデートまたは代替ツールへの移行
   - 影響範囲: AngularJSコード処理

- [ ] **gulp-mustache の更新**
   - 現在: ~2.0.1
   - 脆弱性: 高（mustache 2.2.1未満）
   - 対応: 最新バージョンへアップデート
   - 影響範囲: テンプレート処理

- [ ] **postcss および関連パッケージの更新**
   - 現在: ^8.5.3
   - 脆弱性: 中程度（RegExpDoS）
   - 対応: 8.4.31以上にアップデート
   - 影響範囲: CSSプロセッシング

### 低優先度（devDependencies関連）

- [ ] **highlight.js の更新**
   - 現在: ^9.18.5
   - 脆弱性: 中程度（ReDoS）
   - 対応: 11.x以上にアップデート
   - 影響範囲: コードハイライト表示

- [ ] **Angular関連パッケージ**
   - 現在: ^1.8.3
   - 脆弱性: 高（複数のXSS、ReDoSなど）
   - 対応: 長期的には Angular への移行（TODO リストに記載済み）
   - 影響範囲: デモ環境のみ（開発環境）

- [ ] **mocha の更新**
   - 現在: ^8.4.0
   - 脆弱性: 中程度（nanoid）
   - 対応: 最新バージョンへアップデート
   - 影響範囲: テスト実行環境

## TODO

- デモ環境(`npm run demo` で起動する環境)の AngularJS から Angular へのマイグレーション
  - [X] JavaScript を TypeScript へマイグレーション
  - [ ] コンポーネントディレクティブの使用
  - [ ] ngUpgrade の導入
  - [ ] ハイブリッドアプリケーションへのマイグレーション
  - [ ] Angular2.0 へのマイグレーション
  - [ ] Angular19 へのマイグレーション

AngularJS から Angular へのマイグレーションベストプラクティスは以下にあります
@https://v17.angular.io/guide/upgrade
```
